import{c as A,R as a,j as n,T as z,_ as L,s as B}from"./styled-components.browser.esm-00336e06.js";import{o as D,b as P,w as O,x as j,s as U,y as M,z as X,M as _}from"./src/newtab/index-b6804a1b.js";import{I as q,a as G,b as H,c as V,u as b,d as T,L as W}from"./LinkItem-829b604a.js";import{d as R}from"./index-3251bcdc.js";import{p as J,R as Q,C as Y}from"./index-f0b504e5.js";import{I as E,a as Z}from"./IconDeviceDesktop-af2fe6e0.js";import{m as ee}from"./motion-19064540.js";import{E as te}from"./ExclamationCircleFilled-40d16a0c.js";import"./FavIconIcon-e7db0f73.js";import"./EllipsisOutlined-f6ea35b2.js";import"./Overflow-3a89b18b.js";import"./index-c869a576.js";var ne=A("external-link","IconExternalLink",[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]]),se=A("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const ie=m=>{const{item:e,titleClass:d="",onChange:K=()=>{},onDelete:y=()=>{},onOpenAll:f=()=>{},onCopyAll:x=()=>{}}=m,[g,u]=a.useState(!1),i=a.useRef(null),{option:k,tools:p}=P(),{homeLinkTimeKey:h}=k.item,v=r=>{const c=r.target.value;c&&(e.title=c,K(c)),u(!1)},C=()=>{u(!0),setTimeout(()=>{i.current.focus({cursor:"end"})},0)},I=a.useCallback(r=>{r.stopPropagation(),r.preventDefault();const c=[{label:"打开全部链接",icon:n.jsx(ne,{}),key:"open-all-link",onClick:f},{label:"复制全部链接",icon:n.jsx(q,{}),key:"copy-all-link",onClick:x},{label:"编辑标题",icon:n.jsx(G,{}),key:"edit-title",onClick:C},{label:"移动分组",icon:n.jsx(H,{}),key:"move-group",onClick:()=>{p.openPublicModal("MoveGroup",{},"auto","移动分组")}},{label:"删除分组",icon:n.jsx(V,{}),key:"del-group",onClick:y}];h==e.timeKey?c.push({label:"从首屏移除",icon:n.jsx(Z,{}),key:"del-home",onClick:()=>{k.setItem("homeLinkTimeKey",null)}}):c.push({label:"添加到首屏",icon:n.jsx(E,{}),key:"add-home",onClick:()=>{k.setItem("homeLinkTimeKey",e.timeKey)}}),p.setRightClickEvent(r,c)},[e.timeKey,h]);return n.jsxs("div",{className:"link-title",onContextMenu:I,children:[g?n.jsx("div",{children:n.jsx(J,{type:"text",ref:i,className:d+" link-title-item link-title-input",defaultValue:e.title,onBlur:v,bordered:!1})}):n.jsx("h4",{onClick:C,className:d+" link-title-item",children:e.title}),h==e.timeKey?n.jsx(z,{title:"此分组已在首屏展示",children:n.jsx("div",{className:"link-title-icon",children:n.jsx(E,{size:18,stroke:1.6})})}):null]})},le=D(ie),{confirm:oe}=_,ae="分组",w={8:3,6:4,4:6},re={show:{opacity:1,y:0,x:0,scale:1},hidden:{opacity:0,y:"100%",x:"100%",scale:.8}},ce=a.forwardRef((m,e)=>n.jsx(Q,{ref:e,gutter:[16,16],children:m.children})),me=m=>{m.forEach(e=>{window.open(e.url)})},pe=m=>{const{link:e,tools:d,option:K}=P(),{linkSpan:y}=K.item,{warpRef:f}=m,[x,g]=a.useState(!1),u=a.useRef(null),i=a.useRef({updateList:[],isChange:!1}).current,k=O();k.useSubscription(t=>{(t||[]).length!==0&&(r(t),d.tabListDrawer=!1)});const p=b(t=>{e.updateData(t),setTimeout(()=>{e.setCache()},0)},150),h=b(t=>{e.updateLink(t),setTimeout(()=>{e.setCache()},0)},150),v=b(t=>{e.deleteLinkByTimeKey(t.map(l=>l.timeKey)),setTimeout(()=>{e.setCache()},0)},150),C=j((t,l=!1)=>{l?oe({title:"确认删除全部?",icon:n.jsx(te,{}),content:"即将删除此分组下所有链接",okText:"确认",okType:"danger",cancelText:"取消",onOk(){L.remove(e.list,s=>s.timeKey===t.timeKey||s.parentId===t.timeKey),p(e.list)},onCancel(){}}):(v([t]),L.remove(e.list,s=>s.timeKey===t.timeKey))},[e.list]),I=j((t,l)=>{L.remove(e.list,s=>s.parentId===t),e.list.push(...Array.from(l)),i.isChange&&(p(e.list),i.isChange=!1)},[e.list,p,i]),r=j(t=>{i.isChange=!0;const l=U(),s=[];s.push({title:ae,timeKey:l,parentId:e.getActiveID,sort:e.titleLink.length}),s.push(...M(t,l,!0)),e.list.push(...Array.from(s)),p(e.list),i.isChange=!1},[i,e.getActiveID,e.titleLink.length,e.list,p]),c=j(t=>{const l=t.map(s=>s.title+" "+s.url).join(`
`);X(l).then(s=>{s?d.messageApi.open({type:"success",content:"复制成功"}):d.messageApi.open({type:"error",content:"复制失败"})})}),S=T(()=>e.titleLink.map((t,l)=>{const s=e.linkForId(t.timeKey);return n.jsxs("div",{className:`link-panel link-module-span-${w[y]}`,children:[n.jsx(le,{item:t,onChange:()=>{h([t])},onOpenAll:()=>{me(s)},onCopyAll:()=>{c(s)},onDelete:()=>{C(t,s.length>0)}}),n.jsx(R.ReactSortable,{tag:ce,name:"tab-list",animation:150,group:"linkItem",ghostClass:["link-item-ghost"],list:s,scroll:u.current,setList:o=>{i.updateList[t.timeKey]&&(i.isChange=!0,Promise.resolve().then(()=>{I(t.timeKey,M(o,t.timeKey)),i.updateList[t.timeKey]=!1}))},onStart:o=>{g(!0)},onEnd:o=>{g(!1)},onUpdate:o=>{i.updateList[t.timeKey]=!0},onAdd:o=>{i.updateList[t.timeKey]=!0},onRemove:o=>{i.updateList[t.timeKey]=!0},children:s.map(o=>n.jsx(Y,{span:w[y],children:n.jsx(W,{...o,onDelete:()=>{v([o]),L.remove(e.list,$=>$.timeKey===o.timeKey)}})},o.timeKey))})]},t.timeKey)}),[e.titleLink,e.linkForId,y,h,i,I]),N=T(()=>n.jsxs("div",{className:`link-new-panel ${e.titleLink.length===0?"null fadeIn-element":""}`,children:[e.titleLink.length===0?n.jsx("span",{className:"null_help ",children:"请从右侧拖入标签到区块内"}):null,n.jsx(R.ReactSortable,{name:"tab-list",animation:150,group:"linkItem",ghostClass:["link-item-ghost-new"],list:[],setList:t=>{t.length!==0&&r(t)}})]}),[r,e.titleLink]),F=T(()=>n.jsxs(ee.div,{className:"link-delect-panel",initial:"hidden",animate:x?"show":"hidden",variants:re,transition:{duration:.2,ease:"easeIn"},children:[n.jsx(R.ReactSortable,{name:"tab-list",animation:150,group:"linkItem",className:"link-delect-panel-box",ghostClass:["link-item-delect"],list:[],setList:t=>{}}),n.jsx(se,{size:40})]}),[x]);return a.useEffect(()=>{e.addPanelToLinkItemEmitter=k},[]),a.useEffect(()=>{f.current&&!u.current&&(u.current=f.current.querySelector(".scroll-container"))},[f,u]),e.isInit?n.jsxs(n.Fragment,{children:[S,N,F]}):null},ue=D(pe),de=B.div`
  padding: 20px;
`,ke=m=>{const e=a.useRef(null);return n.jsx(de,{ref:e,children:n.jsx(ue,{warpRef:e})})},Te=D(ke);export{Te as default};
