import{c as je,r as w,az as Ft,bh as Bt,j as v,T as ge,R as O,s as R,bi as Lt,n as B,bg as Ht,bj as Dt}from"./styled-components.browser.esm-00336e06.js";import{_ as P,D as E,E as K,F as We,G as le,H as mt,I as Ke,J as zt,N as _t,O as ht,u as gt,x as j,Q as Wt,R as Kt,a as Ut,g as oe,S as de,T as qt,B as ue,o as vt,b as yt,w as Jt,U as Qe,V as Ze,t as Gt}from"./src/newtab/index-b6804a1b.js";import{b as ie,d as Yt,e as Xt,i as Qt,f as Zt,c as bt,I as Vt}from"./index-870be7e8.js";import{d as xt,T as en,c as $e}from"./LinkItem-829b604a.js";import{i as Ve,u as tn,I as nn,a as rn,P as V,b as ee,S as te,l as on,c as an,T as _,d as sn,e as cn,j as ln,f as un,g as fn,h as dn,k as kt,m as pn,n as mn,o as hn,p as gn,q as vn,r as yn,s as bn,t as xn,v as kn,w as wn,x as Sn,y as et,N as wt,z as Mn,A as ve,F as ye,B as Cn,C as In,D as Tn,E as jn,G as Oe,R as En,H as An,J as St,K as Pn,L as $n,M as On,O as Rn,Q as Nn,U as Fn,V as Mt,W as Bn,X as Ln}from"./Home-c947a821.js";import{m as Hn}from"./motion-19064540.js";import{a as Dn,I as tt}from"./IconDeviceDesktop-af2fe6e0.js";import{C as nt}from"./index-88c73fff.js";import{R as zn,C as Ct}from"./index-f0b504e5.js";import"./Overflow-3a89b18b.js";import"./ExclamationCircleFilled-40d16a0c.js";import"./index-c869a576.js";import"./FavIconIcon-e7db0f73.js";import"./EllipsisOutlined-f6ea35b2.js";import"./index-92392f70.js";import"./SearchIcon-c855861e.js";import"./index-df37a87c.js";import"./index-3251bcdc.js";import"./index-447b9829.js";var _n=je("arrow-back-up","IconArrowBackUp",[["path",{d:"M9 14l-4 -4l4 -4",key:"svg-0"}],["path",{d:"M5 10h11a4 4 0 1 1 0 8h-1",key:"svg-1"}]]),Wn=je("arrow-forward-up","IconArrowForwardUp",[["path",{d:"M15 14l4 -4l-4 -4",key:"svg-0"}],["path",{d:"M19 10h-11a4 4 0 1 0 0 8h1",key:"svg-1"}]]),Kn=je("list","IconList",[["path",{d:"M9 6l11 0",key:"svg-0"}],["path",{d:"M9 12l11 0",key:"svg-1"}],["path",{d:"M9 18l11 0",key:"svg-2"}],["path",{d:"M5 6l0 .01",key:"svg-3"}],["path",{d:"M5 12l0 .01",key:"svg-4"}],["path",{d:"M5 18l0 .01",key:"svg-5"}]]),Un=je("select","IconSelect",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M9 11l3 3l3 -3",key:"svg-1"}]]),It=function(t,e){var n=e.manual,r=e.ready,o=r===void 0?!0:r,a=e.defaultParams,i=a===void 0?[]:a,c=e.refreshDeps,s=c===void 0?[]:c,l=e.refreshDepsAction,f=w.useRef(!1);return f.current=!1,ie(function(){!n&&o&&(f.current=!0,t.run.apply(t,P([],E(i),!1)))},[o]),ie(function(){f.current||n||(f.current=!0,l?l():t.refresh())},P([],E(s),!1)),{onBefore:function(){if(!o)return{stopNow:!0}}}};It.onInit=function(t){var e=t.ready,n=e===void 0?!0:e,r=t.manual;return{loading:!r&&n}};const qn=It;var be=new Map,Jn=function(t,e,n){var r=be.get(t);r?.timer&&clearTimeout(r.timer);var o=void 0;e>-1&&(o=setTimeout(function(){be.delete(t)},e)),be.set(t,K(K({},n),{timer:o}))},Gn=function(t){return be.get(t)},xe=new Map,Yn=function(t){return xe.get(t)},Xn=function(t,e){xe.set(t,e),e.then(function(n){return xe.delete(t),n}).catch(function(){xe.delete(t)})},Q={},Qn=function(t,e){Q[t]&&Q[t].forEach(function(n){return n(e)})},Re=function(t,e){return Q[t]||(Q[t]=[]),Q[t].push(e),function(){var r=Q[t].indexOf(e);Q[t].splice(r,1)}},Zn=function(t,e){var n=e.cacheKey,r=e.cacheTime,o=r===void 0?5*60*1e3:r,a=e.staleTime,i=a===void 0?0:a,c=e.setCache,s=e.getCache,l=w.useRef(void 0),f=w.useRef(void 0),u=function(d,m){c?c(m):Jn(d,o,m),Qn(d,m.data)},p=function(d,m){return m===void 0&&(m=[]),s?s(m):Gn(d)};return xt(function(){if(n){var d=p(n);d&&Object.hasOwnProperty.call(d,"data")&&(t.state.data=d.data,t.state.params=d.params,(i===-1||Date.now()-d.time<=i)&&(t.state.loading=!1)),l.current=Re(n,function(m){t.setState({data:m})})}},[]),We(function(){var d;(d=l.current)===null||d===void 0||d.call(l)}),n?{onBefore:function(d){var m=p(n,d);return!m||!Object.hasOwnProperty.call(m,"data")?{}:i===-1||Date.now()-m.time<=i?{loading:!1,data:m?.data,error:void 0,returnNow:!0}:{data:m?.data,error:void 0}},onRequest:function(d,m){var g=Yn(n);return g&&g!==f.current?{servicePromise:g}:(g=d.apply(void 0,P([],E(m),!1)),f.current=g,Xn(n,g),{servicePromise:g})},onSuccess:function(d,m){var g;n&&((g=l.current)===null||g===void 0||g.call(l),u(n,{data:d,params:m,time:Date.now()}),l.current=Re(n,function(x){t.setState({data:x})}))},onMutate:function(d){var m;n&&((m=l.current)===null||m===void 0||m.call(l),u(n,{data:d,params:t.state.params,time:Date.now()}),l.current=Re(n,function(g){t.setState({data:g})}))}}:{}};const Vn=Zn;var er=function(t,e){var n=e.debounceWait,r=e.debounceLeading,o=e.debounceTrailing,a=e.debounceMaxWait,i=w.useRef(void 0),c=w.useMemo(function(){var s={};return r!==void 0&&(s.leading=r),o!==void 0&&(s.trailing=o),a!==void 0&&(s.maxWait=a),s},[r,o,a]);return w.useEffect(function(){if(n){var s=t.runAsync.bind(t);return i.current=Yt(function(l){l()},n,c),t.runAsync=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];return new Promise(function(u,p){var d;(d=i.current)===null||d===void 0||d.call(i,function(){s.apply(void 0,P([],E(l),!1)).then(u).catch(p)})})},function(){var l;(l=i.current)===null||l===void 0||l.cancel(),t.runAsync=s}}},[n,c]),n?{onCancel:function(){var s;(s=i.current)===null||s===void 0||s.cancel()}}:{}};const tr=er;var nr=function(t,e){var n=e.loadingDelay,r=e.ready,o=w.useRef(void 0);if(!n)return{};var a=function(){o.current&&clearTimeout(o.current)};return{onBefore:function(){return a(),r!==!1&&(o.current=setTimeout(function(){t.setState({loading:!0})},n)),{loading:!1}},onFinally:function(){a()},onCancel:function(){a()}}};const rr=nr;function Ue(){return le?document.visibilityState!=="hidden":!0}var ke=new Set;function or(t){return ke.add(t),function(){ke.has(t)&&ke.delete(t)}}if(le){var ar=function(){Ue()&&ke.forEach(function(t){return t()})};window.addEventListener("visibilitychange",ar,!1)}var sr=function(t,e){var n=e.pollingInterval,r=e.pollingWhenHidden,o=r===void 0?!0:r,a=e.pollingErrorRetryCount,i=a===void 0?-1:a,c=w.useRef(void 0),s=w.useRef(void 0),l=w.useRef(0),f=function(){var u;c.current&&clearTimeout(c.current),(u=s.current)===null||u===void 0||u.call(s)};return ie(function(){n||f()},[n]),n?{onBefore:function(){f()},onError:function(){l.current+=1},onSuccess:function(){l.current=0},onFinally:function(){i===-1||i!==-1&&l.current<=i?c.current=setTimeout(function(){!o&&!Ue()?s.current=or(function(){t.refresh()}):t.refresh()},n):l.current=0},onCancel:function(){f()}}:{}};const ir=sr;function cr(t,e){var n=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n||(n=!0,t.apply(void 0,P([],E(r),!1)),setTimeout(function(){n=!1},e))}}var lr=function(){return le&&typeof navigator.onLine<"u"?navigator.onLine:!0};const ur=lr;var we=new Set;function fr(t){return we.add(t),function(){we.has(t)&&we.delete(t)}}if(le){var rt=function(){!Ue()||!ur()||we.forEach(function(t){return t()})};window.addEventListener("visibilitychange",rt,!1),window.addEventListener("focus",rt,!1)}var dr=function(t,e){var n=e.refreshOnWindowFocus,r=e.focusTimespan,o=r===void 0?5e3:r,a=w.useRef(void 0),i=function(){var c;(c=a.current)===null||c===void 0||c.call(a)};return w.useEffect(function(){if(n){var c=cr(t.refresh.bind(t),o);a.current=fr(function(){c()})}return function(){i()}},[n,o]),We(function(){i()}),{}};const pr=dr;var mr=function(t,e){var n=e.retryInterval,r=e.retryCount,o=w.useRef(void 0),a=w.useRef(0),i=w.useRef(!1);return r?{onBefore:function(){i.current||(a.current=0),i.current=!1,o.current&&clearTimeout(o.current)},onSuccess:function(){a.current=0},onError:function(){if(a.current+=1,r===-1||a.current<=r){var c=n??Math.min(1e3*Math.pow(2,a.current),3e4);o.current=setTimeout(function(){i.current=!0,t.refresh()},c)}else a.current=0},onCancel:function(){a.current=0,o.current&&clearTimeout(o.current)}}:{}};const hr=mr;var gr=Xt,vr=Qt,yr="Expected a function";function br(t,e,n){var r=!0,o=!0;if(typeof t!="function")throw new TypeError(yr);return vr(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),gr(t,e,{leading:r,maxWait:e,trailing:o})}var xr=br;const kr=Ft(xr);var wr=function(t,e){var n=e.throttleWait,r=e.throttleLeading,o=e.throttleTrailing,a=w.useRef(void 0),i={};return r!==void 0&&(i.leading=r),o!==void 0&&(i.trailing=o),w.useEffect(function(){if(n){var c=t.runAsync.bind(t);return a.current=kr(function(s){s()},n,i),t.runAsync=function(){for(var s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];return new Promise(function(f,u){var p;(p=a.current)===null||p===void 0||p.call(a,function(){c.apply(void 0,P([],E(s),!1)).then(f).catch(u)})})},function(){var s;t.runAsync=c,(s=a.current)===null||s===void 0||s.cancel()}}},[n,r,o]),n?{onCancel:function(){var c;(c=a.current)===null||c===void 0||c.cancel()}}:{}};const Sr=wr;var Mr=function(t){mt&&(Ke(t)||console.error('useMount: parameter `fn` expected to be a function, but got "'.concat(typeof t,'".'))),w.useEffect(function(){var e=t?.();if(!(e&&typeof e=="object"&&typeof e.then=="function"))return e},[])};const Cr=Mr;var Ir=function(){function t(e,n,r,o){o===void 0&&(o={}),this.serviceRef=e,this.options=n,this.subscribe=r,this.initState=o,this.pluginImpls=[],this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=K(K(K({},this.state),{loading:!n.manual}),o)}return t.prototype.setState=function(e){e===void 0&&(e={}),this.state=K(K({},this.state),e),this.subscribe()},t.prototype.runPluginHandler=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.pluginImpls.map(function(a){var i;return(i=a[e])===null||i===void 0?void 0:i.call.apply(i,P([a],E(n),!1))}).filter(Boolean);return Object.assign.apply(Object,P([{}],E(o),!1))},t.prototype.runAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return zt(this,void 0,void 0,function(){var r,o,a,i,c,s,l,f,u,p,d,m,g,x,y,S,C,T,I,h,b;return _t(this,function(k){switch(k.label){case 0:if(this.count+=1,r=this.count,o=this.runPluginHandler("onBefore",e),a=o.stopNow,i=a===void 0?!1:a,c=o.returnNow,s=c===void 0?!1:c,l=ht(o,["stopNow","returnNow"]),i)return[2,new Promise(function(){})];if(this.setState(K({loading:!0,params:e},l)),s)return[2,Promise.resolve(l.data)];(g=(m=this.options).onBefore)===null||g===void 0||g.call(m,e),k.label=1;case 1:return k.trys.push([1,3,,4]),f=this.runPluginHandler("onRequest",this.serviceRef.current,e).servicePromise,f||(f=(d=this.serviceRef).current.apply(d,P([],E(e),!1))),[4,f];case 2:return u=k.sent(),r!==this.count?[2,new Promise(function(){})]:(this.setState({data:u,error:void 0,loading:!1}),(y=(x=this.options).onSuccess)===null||y===void 0||y.call(x,u,e),this.runPluginHandler("onSuccess",u,e),(C=(S=this.options).onFinally)===null||C===void 0||C.call(S,e,u,void 0),r===this.count&&this.runPluginHandler("onFinally",e,u,void 0),[2,u]);case 3:if(p=k.sent(),r!==this.count)return[2,new Promise(function(){})];throw this.setState({error:p,loading:!1}),(I=(T=this.options).onError)===null||I===void 0||I.call(T,p,e),this.runPluginHandler("onError",p,e),(b=(h=this.options).onFinally)===null||b===void 0||b.call(h,e,void 0,p),r===this.count&&this.runPluginHandler("onFinally",e,void 0,p),p;case 4:return[2]}})})},t.prototype.run=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];this.runAsync.apply(this,P([],E(n),!1)).catch(function(o){e.options.onError||console.error(o)})},t.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},t.prototype.refresh=function(){this.run.apply(this,P([],E(this.state.params||[]),!1))},t.prototype.refreshAsync=function(){return this.runAsync.apply(this,P([],E(this.state.params||[]),!1))},t.prototype.mutate=function(e){var n=Ke(e)?e(this.state.data):e;this.runPluginHandler("onMutate",n),this.setState({data:n})},t}();const Tr=Ir;function jr(t,e,n){e===void 0&&(e={}),n===void 0&&(n=[]);var r=e.manual,o=r===void 0?!1:r,a=e.ready,i=a===void 0?!0:a,c=ht(e,["manual","ready"]);mt&&e.defaultParams&&!Array.isArray(e.defaultParams)&&console.warn("expected defaultParams is array, got ".concat(typeof e.defaultParams));var s=K({manual:o,ready:i},c),l=gt(t),f=Zt(),u=xt(function(){var p=n.map(function(d){var m;return(m=d?.onInit)===null||m===void 0?void 0:m.call(d,s)}).filter(Boolean);return new Tr(l,s,f,Object.assign.apply(Object,P([{}],E(p),!1)))},[]);return u.options=s,u.pluginImpls=n.map(function(p){return p(u,s)}),Cr(function(){if(!o&&i){var p=u.state.params||e.defaultParams||[];u.run.apply(u,P([],E(p),!1))}}),We(function(){u.cancel()}),{loading:u.state.loading,data:u.state.data,error:u.state.error,params:u.state.params||[],cancel:j(u.cancel.bind(u)),refresh:j(u.refresh.bind(u)),refreshAsync:j(u.refreshAsync.bind(u)),run:j(u.run.bind(u)),runAsync:j(u.runAsync.bind(u)),mutate:j(u.mutate.bind(u))}}function Er(t,e,n){return jr(t,e,P(P([],E(n||[]),!1),[tr,rr,ir,pr,Sr,qn,Vn,hr],!1))}function Ar(t,e){var n,r,o=[],a;Array.isArray(e)?o=e:Ve(e)&&(o=(n=e?.defaultSelected)!==null&&n!==void 0?n:o,a=(r=e?.itemKey)!==null&&r!==void 0?r:a);var i=function(h){return Ke(a)?a(h):Wt(a)&&Ve(h)?h[a]:h},c=E(w.useState(o),2),s=c[0],l=c[1],f=w.useMemo(function(){var h=new Map;return Array.isArray(s)&&s.forEach(function(b){h.set(i(b),b)}),h},[s]),u=function(h){return f.has(i(h))},p=function(h){f.set(i(h),h),l(Array.from(f.values()))},d=function(h){f.delete(i(h)),l(Array.from(f.values()))},m=function(h){u(h)?d(h):p(h)},g=function(){t.forEach(function(h){f.set(i(h),h)}),l(Array.from(f.values()))},x=function(){t.forEach(function(h){f.delete(i(h))}),l(Array.from(f.values()))},y=w.useMemo(function(){return t.every(function(h){return!f.has(i(h))})},[t,f]),S=w.useMemo(function(){return t.every(function(h){return f.has(i(h))})&&!y},[t,f,y]),C=w.useMemo(function(){return!y&&!S},[y,S]),T=function(){return S?x():g()},I=function(){f.clear(),l([])};return{selected:s,noneSelected:y,allSelected:S,partiallySelected:C,setSelected:l,isSelected:u,select:j(p),unSelect:j(d),toggle:j(m),selectAll:j(g),unSelectAll:j(x),clearAll:j(I),toggleAll:j(T)}}var Pr=Kt(w.useLayoutEffect);const $r=Pr;var Or=le?$r:Ut;const Rr=Or;function Nr(t){var e=E(tn(function(){var o=oe(t);return o?{width:o.clientWidth,height:o.clientHeight}:void 0}),2),n=e[0],r=e[1];return Rr(function(){var o=oe(t);if(o){var a=new Bt(function(i){i.forEach(function(c){var s=c.target,l=s.clientWidth,f=s.clientHeight;r({width:l,height:f})})});return a.observe(o),function(){a.disconnect()}}},[],t),n}var Fr=function(t,e){var n=e.containerTarget,r=e.wrapperTarget,o=e.itemHeight,a=e.overscan,i=a===void 0?5:a,c=gt(o),s=Nr(n),l=w.useRef(!1),f=E(w.useState([]),2),u=f[0],p=f[1],d=E(w.useState({}),2),m=d[0],g=d[1],x=function(h,b){if(de(c.current))return Math.ceil(h/c.current);for(var k=0,A=0,F=b;F<t.length;F++){var D=c.current(F,t[F]);if(k+=D,A=F,k>=h)break}return A-b},y=function(h){if(de(c.current))return Math.floor(h/c.current);for(var b=0,k=0,A=0;A<t.length;A++){var F=c.current(A,t[A]);if(b+=F,b>=h){k=A;break}}return k+1},S=function(h){if(de(c.current)){var b=h*c.current;return b}var k=t.slice(0,h).reduce(function(A,F,D){return A+c.current(D,t[D])},0);return k},C=w.useMemo(function(){return de(c.current)?t.length*c.current:t.reduce(function(h,b,k){return h+c.current(k,t[k])},0)},[t]),T=function(){var h=oe(n);if(h){var b=h.scrollTop,k=h.clientHeight,A=y(b),F=x(k,A),D=Math.max(0,A-i),Ae=Math.min(t.length,A+F+i),fe=S(D);g({height:C-fe+"px",marginTop:fe+"px"}),p(t.slice(D,Ae).map(function(M,W){return{data:M,index:W+D}}))}};ie(function(){var h=oe(r);h&&Object.keys(m).forEach(function(b){return h.style[b]=m[b]})},[m]),w.useEffect(function(){!s?.width||!s?.height||T()},[s?.width,s?.height,t]),qt("scroll",function(h){if(l.current){l.current=!1;return}h.preventDefault(),T()},{target:n});var I=function(h){var b=oe(n);b&&(l.current=!0,b.scrollTop=S(h),T())};return[u,j(I)]};const Br=Fr;function Lr(t){const{editor:e}=t;if(!e)return null;const n=j(r=>{const{onClick:o,disabled:a,active:i,title:c,Icon:s}=r;return v.jsx(ge,{title:c,children:v.jsx(ue,{onClick:o,disabled:a,type:i?"primary":"text",icon:v.jsx(s,{size:20,stroke:1.4})})})});return v.jsx("div",{className:"sn-editor-menuBar",children:v.jsxs("div",{children:[n({onClick:()=>e.chain().focus().toggleBold().run(),disabled:!e.can().chain().focus().toggleBold().run(),active:e.isActive("bold"),title:"加粗",Icon:nn}),n({onClick:()=>e.chain().focus().toggleBulletList().run(),disabled:!1,active:e.isActive("bulletList"),title:"无序列表",Icon:Kn}),n({onClick:()=>e.chain().focus().toggleTaskList().run(),disabled:!1,active:e.isActive("taskList"),title:"任务列表",Icon:rn}),n({onClick:()=>e.chain().focus().undo().run(),disabled:!e.can().chain().focus().undo().run(),active:!1,title:"撤销",Icon:_n}),n({onClick:()=>e.chain().focus().redo().run(),disabled:!e.can().chain().focus().redo().run(),active:!1,title:"重做",Icon:Wn})]})})}function Tt(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:o}=n,{storedMarks:a}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return a},get selection(){return r},get doc(){return o},get tr(){return r=n.selection,o=n.doc,a=n.storedMarks,n}}}class Hr{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:o}=n,{tr:a}=r,i=this.buildProps(a);return Object.fromEntries(Object.entries(e).map(([c,s])=>[c,(...f)=>{const u=s(...f)(i);return!a.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(a),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:o,state:a}=this,{view:i}=o,c=[],s=!!e,l=e||a.tr,f=()=>(!s&&n&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),c.every(p=>p===!0)),u={...Object.fromEntries(Object.entries(r).map(([p,d])=>[p,(...g)=>{const x=this.buildProps(l,n),y=d(...g)(x);return c.push(y),u}])),run:f};return u}createCan(e){const{rawCommands:n,state:r}=this,o=!1,a=e||r.tr,i=this.buildProps(a,o);return{...Object.fromEntries(Object.entries(n).map(([s,l])=>[s,(...f)=>l(...f)({...i,dispatch:void 0})])),chain:()=>this.createChain(a,o)}}buildProps(e,n=!0){const{rawCommands:r,editor:o,state:a}=this,{view:i}=o,c={tr:e,editor:o,view:i,state:Tt({state:a,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([s,l])=>[s,(...f)=>l(...f)(c)]))}};return c}}function L(t,e,n){return t.config[e]===void 0&&t.parent?L(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?L(t.parent,e,n):null}):t.config[e]}function Dr(t){const e=t.filter(o=>o.type==="extension"),n=t.filter(o=>o.type==="node"),r=t.filter(o=>o.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function $(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function zr(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([o,a])=>{if(!r[o]){r[o]=a;return}if(o==="class"){const c=a?a.split(" "):[],s=r[o]?r[o].split(" "):[],l=c.filter(f=>!s.includes(f));r[o]=[...s,...l].join(" ")}else if(o==="style"){const c=a?a.split(";").map(f=>f.trim()).filter(Boolean):[],s=r[o]?r[o].split(";").map(f=>f.trim()).filter(Boolean):[],l=new Map;s.forEach(f=>{const[u,p]=f.split(":").map(d=>d.trim());l.set(u,p)}),c.forEach(f=>{const[u,p]=f.split(":").map(d=>d.trim());l.set(u,p)}),r[o]=Array.from(l.entries()).map(([f,u])=>`${f}: ${u}`).join("; ")}else r[o]=a}),r},{})}function _r(t){return typeof t=="function"}function U(t,e=void 0,...n){return _r(t)?e?t.bind(e)(...n):t(...n):t}function Wr(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Kr(t){return Object.prototype.toString.call(t).slice(8,-1)}function pe(t){return Kr(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function qe(t,e){const n={...t};return pe(t)&&pe(e)&&Object.keys(e).forEach(r=>{pe(e[r])&&pe(t[r])?n[r]=qe(t[r],e[r]):n[r]=e[r]}),n}class H{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=U(L(this,"addOptions",{name:this.name}))),this.storage=U(L(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new H(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>qe(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new H({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=U(L(n,"addOptions",{name:n.name})),n.storage=U(L(n,"addStorage",{name:n.name,options:n.options})),n}}function Ur(t,e,n){const{from:r,to:o}=e,{blockSeparator:a=`

`,textSerializers:i={}}=n||{};let c="";return t.nodesBetween(r,o,(s,l,f,u)=>{var p;s.isBlock&&l>r&&(c+=a);const d=i?.[s.type.name];if(d)return f&&(c+=d({node:s,pos:l,parent:f,index:u,range:e})),!1;s.isText&&(c+=(p=s?.text)===null||p===void 0?void 0:p.slice(Math.max(r,l)-l,o-l))}),c}function qr(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}H.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new V({key:new ee("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:o}=e,{ranges:a}=o,i=Math.min(...a.map(f=>f.$from.pos)),c=Math.max(...a.map(f=>f.$to.pos)),s=qr(n);return Ur(r,{from:i,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:s})}}})]}});const Jr=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Gr=(t=!1)=>({commands:e})=>e.setContent("",t),Yr=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:o}=r;return n&&o.forEach(({$from:a,$to:i})=>{t.doc.nodesBetween(a.pos,i.pos,(c,s)=>{if(c.type.isText)return;const{doc:l,mapping:f}=e,u=l.resolve(f.map(s)),p=l.resolve(f.map(s+c.nodeSize)),d=u.blockRange(p);if(!d)return;const m=on(d);if(c.type.isTextblock){const{defaultType:g}=u.parent.contentMatchAt(u.index());e.setNodeMarkup(d.start,g)}(m||m===0)&&e.lift(d,m)})}),!0},Xr=t=>e=>t(e),Qr=()=>({state:t,dispatch:e})=>an(t,e),Zr=(t,e)=>({editor:n,tr:r})=>{const{state:o}=n,a=o.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const i=r.mapping.map(e);return r.insert(i,a.content),r.setSelection(new _(r.doc.resolve(i-1))),!0},Vr=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const o=t.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===r.type){if(e){const c=o.before(a),s=o.after(a);t.delete(c,s).scrollIntoView()}return!0}return!1},eo=t=>({tr:e,state:n,dispatch:r})=>{const o=$(t,n.schema),a=e.selection.$anchor;for(let i=a.depth;i>0;i-=1)if(a.node(i).type===o){if(r){const s=a.before(i),l=a.after(i);e.delete(s,l).scrollIntoView()}return!0}return!1},to=t=>({tr:e,dispatch:n})=>{const{from:r,to:o}=t;return n&&e.delete(r,o),!0},no=()=>({state:t,dispatch:e})=>sn(t,e),ro=()=>({commands:t})=>t.keyboardShortcut("Enter"),oo=()=>({state:t,dispatch:e})=>cn(t,e);function Me(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(o=>n.strict?e[o]===t[o]:Wr(e[o])?e[o].test(t[o]):e[o]===t[o]):!0}function De(t,e,n={}){return t.find(r=>r.type===e&&Me(r.attrs,n))}function ao(t,e,n={}){return!!De(t,e,n)}function jt(t,e,n={}){if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if((!r.node||!r.node.marks.some(l=>l.type===e))&&(r=t.parent.childBefore(t.parentOffset)),!r.node||!r.node.marks.some(l=>l.type===e))return;const o=De([...r.node.marks],e,n);if(!o)return;let a=r.index,i=t.start()+r.offset,c=a+1,s=i+r.node.nodeSize;for(De([...r.node.marks],e,n);a>0&&o.isInSet(t.parent.child(a-1).marks);)a-=1,i-=t.parent.child(a).nodeSize;for(;c<t.parent.childCount&&ao([...t.parent.child(c).marks],e,n);)s+=t.parent.child(c).nodeSize,c+=1;return{from:i,to:s}}function q(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const so=(t,e={})=>({tr:n,state:r,dispatch:o})=>{const a=q(t,r.schema),{doc:i,selection:c}=n,{$from:s,from:l,to:f}=c;if(o){const u=jt(s,a,e);if(u&&u.from<=l&&u.to>=f){const p=_.create(i,u.from,u.to);n.setSelection(p)}}return!0},io=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function Et(t){return t instanceof _}function Z(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function co(t,e=null){if(!e)return null;const n=te.atStart(t),r=te.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const o=n.from,a=r.to;return e==="all"?_.create(t,Z(0,o,a),Z(t.content.size,o,a)):_.create(t,Z(e,o,a),Z(e,o,a))}function Je(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const lo=(t=null,e={})=>({editor:n,view:r,tr:o,dispatch:a})=>{e={scrollIntoView:!0,...e};const i=()=>{Je()&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!Et(n.state.selection))return i(),!0;const c=co(o.doc,t)||n.state.selection,s=n.state.selection.eq(c);return a&&(s||o.setSelection(c),s&&o.storedMarks&&o.setStoredMarks(o.storedMarks),i()),!0},uo=(t,e)=>n=>t.every((r,o)=>e(r,{...n,index:o})),fo=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),At=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&At(r)}return t};function me(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return At(n)}function Ce(t,e,n){n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,o=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return ye.fromArray(t.map(c=>e.nodeFromJSON(c)));const i=e.nodeFromJSON(t);return n.errorOnInvalidContent&&i.check(),i}catch(a){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",a),Ce("",e,n)}if(o){if(n.errorOnInvalidContent){let i=!1,c="";const s=new jn({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:l=>(i=!0,c=typeof l=="string"?l:l.outerHTML,null)}]}})});if(n.slice?Oe.fromSchema(s).parseSlice(me(t),n.parseOptions):Oe.fromSchema(s).parse(me(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const a=Oe.fromSchema(e);return n.slice?a.parseSlice(me(t),n.parseOptions).content:a.parse(me(t),n.parseOptions)}return Ce("",e,n)}function po(t,e,n){const r=t.steps.length-1;if(r<e)return;const o=t.steps[r];if(!(o instanceof En||o instanceof An))return;const a=t.mapping.maps[r];let i=0;a.forEach((c,s,l,f)=>{i===0&&(i=f)}),t.setSelection(te.near(t.doc.resolve(i),n))}const mo=t=>!("type"in t),ho=(t,e,n)=>({tr:r,dispatch:o,editor:a})=>{var i;if(o){n={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let c;try{c=Ce(e,a.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:(i=n.errorOnInvalidContent)!==null&&i!==void 0?i:a.options.enableContentCheck})}catch(m){return a.emit("contentError",{editor:a,error:m,disableCollaboration:()=>{a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}}),!1}let{from:s,to:l}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,u=!0;if((mo(c)?c:[c]).forEach(m=>{m.check(),f=f?m.isText&&m.marks.length===0:!1,u=u?m.isBlock:!1}),s===l&&u){const{parent:m}=r.doc.resolve(s);m.isTextblock&&!m.type.spec.code&&!m.childCount&&(s-=1,l+=1)}let d;f?(Array.isArray(e)?d=e.map(m=>m.text||"").join(""):typeof e=="object"&&e&&e.text?d=e.text:d=e,r.insertText(d,s,l)):(d=c,r.replaceWith(s,l,d)),n.updateSelection&&po(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:s,text:d}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:s,text:d})}return!0},go=()=>({state:t,dispatch:e})=>ln(t,e),vo=()=>({state:t,dispatch:e})=>un(t,e),yo=()=>({state:t,dispatch:e})=>fn(t,e),bo=()=>({state:t,dispatch:e})=>dn(t,e),xo=()=>({state:t,dispatch:e,tr:n})=>{try{const r=kt(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},ko=()=>({state:t,dispatch:e,tr:n})=>{try{const r=kt(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},wo=()=>({state:t,dispatch:e})=>pn(t,e),So=()=>({state:t,dispatch:e})=>mn(t,e);function Pt(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Mo(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,o,a,i;for(let c=0;c<e.length-1;c+=1){const s=e[c];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))r=!0;else if(/^(c|ctrl|control)$/i.test(s))o=!0;else if(/^s(hift)?$/i.test(s))a=!0;else if(/^mod$/i.test(s))Je()||Pt()?i=!0:o=!0;else throw new Error(`Unrecognized modifier name: ${s}`)}return r&&(n=`Alt-${n}`),o&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),a&&(n=`Shift-${n}`),n}const Co=t=>({editor:e,view:n,tr:r,dispatch:o})=>{const a=Mo(t).split(/-(?!$)/),i=a.find(l=>!["Alt","Ctrl","Meta","Shift"].includes(l)),c=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),s=e.captureTransaction(()=>{n.someProp("handleKeyDown",l=>l(n,c))});return s?.steps.forEach(l=>{const f=l.map(r.mapping);f&&o&&r.maybeStep(f)}),!0};function Ge(t,e,n={}){const{from:r,to:o,empty:a}=t.selection,i=e?$(e,t.schema):null,c=[];t.doc.nodesBetween(r,o,(u,p)=>{if(u.isText)return;const d=Math.max(r,p),m=Math.min(o,p+u.nodeSize);c.push({node:u,from:d,to:m})});const s=o-r,l=c.filter(u=>i?i.name===u.node.type.name:!0).filter(u=>Me(u.node.attrs,n,{strict:!1}));return a?!!l.length:l.reduce((u,p)=>u+p.to-p.from,0)>=s}const Io=(t,e={})=>({state:n,dispatch:r})=>{const o=$(t,n.schema);return Ge(n,o,e)?hn(n,r):!1},To=()=>({state:t,dispatch:e})=>gn(t,e),jo=t=>({state:e,dispatch:n})=>{const r=$(t,e.schema);return vn(r)(e,n)},Eo=()=>({state:t,dispatch:e})=>yn(t,e);function $t(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function ot(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,o)=>(n.includes(o)||(r[o]=t[o]),r),{})}const Ao=(t,e)=>({tr:n,state:r,dispatch:o})=>{let a=null,i=null;const c=$t(typeof t=="string"?t:t.name,r.schema);return c?(c==="node"&&(a=$(t,r.schema)),c==="mark"&&(i=q(t,r.schema)),o&&n.selection.ranges.forEach(s=>{r.doc.nodesBetween(s.$from.pos,s.$to.pos,(l,f)=>{a&&a===l.type&&n.setNodeMarkup(f,void 0,ot(l.attrs,e)),i&&l.marks.length&&l.marks.forEach(u=>{i===u.type&&n.addMark(f,f+l.nodeSize,i.create(ot(u.attrs,e)))})})}),!0):!1},Po=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),$o=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),Oo=()=>({state:t,dispatch:e})=>bn(t,e),Ro=()=>({state:t,dispatch:e})=>xn(t,e),No=()=>({state:t,dispatch:e})=>kn(t,e),Fo=()=>({state:t,dispatch:e})=>wn(t,e),Bo=()=>({state:t,dispatch:e})=>Sn(t,e);function Lo(t,e,n={},r={}){return Ce(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const Ho=(t,e=!1,n={},r={})=>({editor:o,tr:a,dispatch:i,commands:c})=>{var s,l;const{doc:f}=a;if(n.preserveWhitespace!=="full"){const u=Lo(t,o.schema,n,{errorOnInvalidContent:(s=r.errorOnInvalidContent)!==null&&s!==void 0?s:o.options.enableContentCheck});return i&&a.replaceWith(0,f.content.size,u).setMeta("preventUpdate",!e),!0}return i&&a.setMeta("preventUpdate",!e),c.insertContentAt({from:0,to:f.content.size},t,{parseOptions:n,errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:o.options.enableContentCheck})};function Do(t,e){const n=q(e,t.schema),{from:r,to:o,empty:a}=t.selection,i=[];a?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,o,s=>{i.push(...s.marks)});const c=i.find(s=>s.type.name===n.name);return c?{...c.attrs}:{}}function zo(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function _o(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Ye(t){return e=>_o(e.$from,t)}function Se(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const o=t.find(a=>a.type===e&&a.name===r);return o?o.attribute.keepOnSplit:!1}))}function Wo(t,e,n={}){const{empty:r,ranges:o}=t.selection,a=e?q(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(u=>a?a.name===u.type.name:!0).find(u=>Me(u.attrs,n,{strict:!1}));let i=0;const c=[];if(o.forEach(({$from:u,$to:p})=>{const d=u.pos,m=p.pos;t.doc.nodesBetween(d,m,(g,x)=>{if(!g.isText&&!g.marks.length)return;const y=Math.max(d,x),S=Math.min(m,x+g.nodeSize),C=S-y;i+=C,c.push(...g.marks.map(T=>({mark:T,from:y,to:S})))})}),i===0)return!1;const s=c.filter(u=>a?a.name===u.mark.type.name:!0).filter(u=>Me(u.mark.attrs,n,{strict:!1})).reduce((u,p)=>u+p.to-p.from,0),l=c.filter(u=>a?u.mark.type!==a&&u.mark.type.excludes(a):!0).reduce((u,p)=>u+p.to-p.from,0);return(s>0?s+l:s)>=i}function at(t,e){const{nodeExtensions:n}=Dr(e),r=n.find(i=>i.name===t);if(!r)return!1;const o={name:r.name,options:r.options,storage:r.storage},a=U(L(r,"group",o));return typeof a!="string"?!1:a.split(" ").includes("list")}function Ot(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let o=!0;return t.content.forEach(a=>{o!==!1&&(Ot(a,{ignoreWhitespace:n,checkChildren:e})||(o=!1))}),o}return!1}function Ko(t,e,n){var r;const{selection:o}=e;let a=null;if(Et(o)&&(a=o.$cursor),a){const c=(r=t.storedMarks)!==null&&r!==void 0?r:a.marks();return!!n.isInSet(c)||!c.some(s=>s.type.excludes(n))}const{ranges:i}=o;return i.some(({$from:c,$to:s})=>{let l=c.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(c.pos,s.pos,(f,u,p)=>{if(l)return!1;if(f.isInline){const d=!p||p.type.allowsMarkType(n),m=!!n.isInSet(f.marks)||!f.marks.some(g=>g.type.excludes(n));l=d&&m}return!l}),l})}const Uo=(t,e={})=>({tr:n,state:r,dispatch:o})=>{const{selection:a}=n,{empty:i,ranges:c}=a,s=q(t,r.schema);if(o)if(i){const l=Do(r,s);n.addStoredMark(s.create({...l,...e}))}else c.forEach(l=>{const f=l.$from.pos,u=l.$to.pos;r.doc.nodesBetween(f,u,(p,d)=>{const m=Math.max(d,f),g=Math.min(d+p.nodeSize,u);p.marks.find(y=>y.type===s)?p.marks.forEach(y=>{s===y.type&&n.addMark(m,g,s.create({...y.attrs,...e}))}):n.addMark(m,g,s.create(e))})});return Ko(r,n,s)},qo=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Jo=(t,e={})=>({state:n,dispatch:r,chain:o})=>{const a=$(t,n.schema);return a.isTextblock?o().command(({commands:i})=>et(a,e)(n)?!0:i.clearNodes()).command(({state:i})=>et(a,e)(i,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Go=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,o=Z(t,0,r.content.size),a=wt.create(r,o);e.setSelection(a)}return!0},Yo=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:o,to:a}=typeof t=="number"?{from:t,to:t}:t,i=_.atStart(r).from,c=_.atEnd(r).to,s=Z(o,i,c),l=Z(a,i,c),f=_.create(r,s,l);e.setSelection(f)}return!0},Xo=t=>({state:e,dispatch:n})=>{const r=$(t,e.schema);return Mn(r)(e,n)};function st(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(o=>e?.includes(o.type.name));t.tr.ensureMarks(r)}}const Qo=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:o})=>{const{selection:a,doc:i}=e,{$from:c,$to:s}=a,l=o.extensionManager.attributes,f=Se(l,c.node().type.name,c.node().attrs);if(a instanceof wt&&a.node.isBlock)return!c.parentOffset||!ve(i,c.pos)?!1:(r&&(t&&st(n,o.extensionManager.splittableMarks),e.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const u=s.parentOffset===s.parent.content.size,p=c.depth===0?void 0:zo(c.node(-1).contentMatchAt(c.indexAfter(-1)));let d=u&&p?[{type:p,attrs:f}]:void 0,m=ve(e.doc,e.mapping.map(c.pos),1,d);if(!d&&!m&&ve(e.doc,e.mapping.map(c.pos),1,p?[{type:p}]:void 0)&&(m=!0,d=p?[{type:p,attrs:f}]:void 0),r){if(m&&(a instanceof _&&e.deleteSelection(),e.split(e.mapping.map(c.pos),1,d),p&&!u&&!c.parentOffset&&c.parent.type!==p)){const g=e.mapping.map(c.before()),x=e.doc.resolve(g);c.node(-1).canReplaceWith(x.index(),x.index()+1,p)&&e.setNodeMarkup(e.mapping.map(c.before()),p)}t&&st(n,o.extensionManager.splittableMarks),e.scrollIntoView()}return m},Zo=(t,e={})=>({tr:n,state:r,dispatch:o,editor:a})=>{var i;const c=$(t,r.schema),{$from:s,$to:l}=r.selection,f=r.selection.node;if(f&&f.isBlock||s.depth<2||!s.sameParent(l))return!1;const u=s.node(-1);if(u.type!==c)return!1;const p=a.extensionManager.attributes;if(s.parent.content.size===0&&s.node(-1).childCount===s.indexAfter(-1)){if(s.depth===2||s.node(-3).type!==c||s.index(-2)!==s.node(-2).childCount-1)return!1;if(o){let y=ye.empty;const S=s.index(-1)?1:s.index(-2)?2:3;for(let k=s.depth-S;k>=s.depth-3;k-=1)y=ye.from(s.node(k).copy(y));const C=s.indexAfter(-1)<s.node(-2).childCount?1:s.indexAfter(-2)<s.node(-3).childCount?2:3,T={...Se(p,s.node().type.name,s.node().attrs),...e},I=((i=c.contentMatch.defaultType)===null||i===void 0?void 0:i.createAndFill(T))||void 0;y=y.append(ye.from(c.createAndFill(null,I)||void 0));const h=s.before(s.depth-(S-1));n.replace(h,s.after(-C),new Cn(y,4-S,0));let b=-1;n.doc.nodesBetween(h,n.doc.content.size,(k,A)=>{if(b>-1)return!1;k.isTextblock&&k.content.size===0&&(b=A+1)}),b>-1&&n.setSelection(_.near(n.doc.resolve(b))),n.scrollIntoView()}return!0}const d=l.pos===s.end()?u.contentMatchAt(0).defaultType:null,m={...Se(p,u.type.name,u.attrs),...e},g={...Se(p,s.node().type.name,s.node().attrs),...e};n.delete(s.pos,l.pos);const x=d?[{type:c,attrs:m},{type:d,attrs:g}]:[{type:c,attrs:m}];if(!ve(n.doc,s.pos,2))return!1;if(o){const{selection:y,storedMarks:S}=r,{splittableMarks:C}=a.extensionManager,T=S||y.$to.parentOffset&&y.$from.marks();if(n.split(s.pos,2,x).scrollIntoView(),!T||!o)return!0;const I=T.filter(h=>C.includes(h.type.name));n.ensureMarks(I)}return!0},Ne=(t,e)=>{const n=Ye(i=>i.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const o=t.doc.nodeAt(r);return n.node.type===o?.type&&St(t.doc,n.pos)&&t.join(n.pos),!0},Fe=(t,e)=>{const n=Ye(i=>i.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const o=t.doc.nodeAt(r);return n.node.type===o?.type&&St(t.doc,r)&&t.join(r),!0},Vo=(t,e,n,r={})=>({editor:o,tr:a,state:i,dispatch:c,chain:s,commands:l,can:f})=>{const{extensions:u,splittableMarks:p}=o.extensionManager,d=$(t,i.schema),m=$(e,i.schema),{selection:g,storedMarks:x}=i,{$from:y,$to:S}=g,C=y.blockRange(S),T=x||g.$to.parentOffset&&g.$from.marks();if(!C)return!1;const I=Ye(h=>at(h.type.name,u))(g);if(C.depth>=1&&I&&C.depth-I.depth<=1){if(I.node.type===d)return l.liftListItem(m);if(at(I.node.type.name,u)&&d.validContent(I.node.content)&&c)return s().command(()=>(a.setNodeMarkup(I.pos,d),!0)).command(()=>Ne(a,d)).command(()=>Fe(a,d)).run()}return!n||!T||!c?s().command(()=>f().wrapInList(d,r)?!0:l.clearNodes()).wrapInList(d,r).command(()=>Ne(a,d)).command(()=>Fe(a,d)).run():s().command(()=>{const h=f().wrapInList(d,r),b=T.filter(k=>p.includes(k.type.name));return a.ensureMarks(b),h?!0:l.clearNodes()}).wrapInList(d,r).command(()=>Ne(a,d)).command(()=>Fe(a,d)).run()},ea=(t,e={},n={})=>({state:r,commands:o})=>{const{extendEmptyMarkRange:a=!1}=n,i=q(t,r.schema);return Wo(r,i,e)?o.unsetMark(i,{extendEmptyMarkRange:a}):o.setMark(i,e)},ta=(t,e,n={})=>({state:r,commands:o})=>{const a=$(t,r.schema),i=$(e,r.schema),c=Ge(r,a,n);let s;return r.selection.$anchor.sameParent(r.selection.$head)&&(s=r.selection.$anchor.parent.attrs),c?o.setNode(i,s):o.setNode(a,{...s,...n})},na=(t,e={})=>({state:n,commands:r})=>{const o=$(t,n.schema);return Ge(n,o,e)?r.lift(o):r.wrapIn(o,e)},ra=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const o=n[r];let a;if(o.spec.isInputRules&&(a=o.getState(t))){if(e){const i=t.tr,c=a.transform;for(let s=c.steps.length-1;s>=0;s-=1)i.step(c.steps[s].invert(c.docs[s]));if(a.text){const s=i.doc.resolve(a.from).marks();i.replaceWith(a.from,a.to,t.schema.text(a.text,s))}else i.delete(a.from,a.to)}return!0}}return!1},oa=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:o}=n;return r||e&&o.forEach(a=>{t.removeMark(a.$from.pos,a.$to.pos)}),!0},aa=(t,e={})=>({tr:n,state:r,dispatch:o})=>{var a;const{extendEmptyMarkRange:i=!1}=e,{selection:c}=n,s=q(t,r.schema),{$from:l,empty:f,ranges:u}=c;if(!o)return!0;if(f&&i){let{from:p,to:d}=c;const m=(a=l.marks().find(x=>x.type===s))===null||a===void 0?void 0:a.attrs,g=jt(l,s,m);g&&(p=g.from,d=g.to),n.removeMark(p,d,s)}else u.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,s)});return n.removeStoredMark(s),!0},sa=(t,e={})=>({tr:n,state:r,dispatch:o})=>{let a=null,i=null;const c=$t(typeof t=="string"?t:t.name,r.schema);return c?(c==="node"&&(a=$(t,r.schema)),c==="mark"&&(i=q(t,r.schema)),o&&n.selection.ranges.forEach(s=>{const l=s.$from.pos,f=s.$to.pos;r.doc.nodesBetween(l,f,(u,p)=>{a&&a===u.type&&n.setNodeMarkup(p,void 0,{...u.attrs,...e}),i&&u.marks.length&&u.marks.forEach(d=>{if(i===d.type){const m=Math.max(p,l),g=Math.min(p+u.nodeSize,f);n.addMark(m,g,i.create({...d.attrs,...e}))}})})}),!0):!1},ia=(t,e={})=>({state:n,dispatch:r})=>{const o=$(t,n.schema);return In(o,e)(n,r)},ca=(t,e={})=>({state:n,dispatch:r})=>{const o=$(t,n.schema);return Tn(o,e)(n,r)};var la=Object.freeze({__proto__:null,blur:Jr,clearContent:Gr,clearNodes:Yr,command:Xr,createParagraphNear:Qr,cut:Zr,deleteCurrentNode:Vr,deleteNode:eo,deleteRange:to,deleteSelection:no,enter:ro,exitCode:oo,extendMarkRange:so,first:io,focus:lo,forEach:uo,insertContent:fo,insertContentAt:ho,joinBackward:yo,joinDown:vo,joinForward:bo,joinItemBackward:xo,joinItemForward:ko,joinTextblockBackward:wo,joinTextblockForward:So,joinUp:go,keyboardShortcut:Co,lift:Io,liftEmptyBlock:To,liftListItem:jo,newlineInCode:Eo,resetAttributes:Ao,scrollIntoView:Po,selectAll:$o,selectNodeBackward:Oo,selectNodeForward:Ro,selectParentNode:No,selectTextblockEnd:Fo,selectTextblockStart:Bo,setContent:Ho,setMark:Uo,setMeta:qo,setNode:Jo,setNodeSelection:Go,setTextSelection:Yo,sinkListItem:Xo,splitBlock:Qo,splitListItem:Zo,toggleList:Vo,toggleMark:ea,toggleNode:ta,toggleWrap:na,undoInputRule:ra,unsetAllMarks:oa,unsetMark:aa,updateAttributes:sa,wrapIn:ia,wrapInList:ca});H.create({name:"commands",addCommands(){return{...la}}});H.create({name:"drop",addProseMirrorPlugins(){return[new V({key:new ee("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}});H.create({name:"editable",addProseMirrorPlugins(){return[new V({key:new ee("editable"),props:{editable:()=>this.editor.options.editable}})]}});H.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new V({key:new ee("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}});H.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:c})=>{const{selection:s,doc:l}=c,{empty:f,$anchor:u}=s,{pos:p,parent:d}=u,m=u.parent.isTextblock&&p>0?c.doc.resolve(p-1):u,g=m.parent.type.spec.isolating,x=u.pos-u.parentOffset,y=g&&m.parent.childCount===1?x===u.pos:te.atStart(l).from===p;return!f||!d.type.isTextblock||d.textContent.length||!y||y&&u.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},o={...r},a={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Je()||Pt()?a:o},addProseMirrorPlugins(){return[new V({key:new ee("clearDocument"),appendTransaction:(t,e,n)=>{const r=t.some(g=>g.docChanged)&&!e.doc.eq(n.doc),o=t.some(g=>g.getMeta("preventClearDocument"));if(!r||o)return;const{empty:a,from:i,to:c}=e.selection,s=te.atStart(e.doc).from,l=te.atEnd(e.doc).to;if(a||!(i===s&&c===l)||!Ot(n.doc))return;const p=n.tr,d=Tt({state:n,transaction:p}),{commands:m}=new Hr({editor:this.editor,state:d});if(m.clearNodes(),!!p.steps.length)return p}})]}});H.create({name:"paste",addProseMirrorPlugins(){return[new V({key:new ee("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}});H.create({name:"tabindex",addProseMirrorPlugins(){return[new V({key:new ee("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Ie{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=U(L(this,"addOptions",{name:this.name}))),this.storage=U(L(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ie(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>qe(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Ie(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=U(L(n,"addOptions",{name:n.name})),n.storage=U(L(n,"addStorage",{name:n.name,options:n.options})),n}}const ua=Ie.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null},"data-id":{default:null},sizeSlug:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){const e=o=>{const{naturalHeight:a}=o.target,c=`height: ${Math.ceil(a/50)*50+50}px;`;o.target.parentNode.setAttribute("style",c)},n=document.createElement("img");n.onload=e;const r=zr(this.options.HTMLAttributes,t);for(const o in r)if(Object.hasOwnProperty.call(r,o)){const a=r[o];n.setAttribute(o,a)}return["figure",{class:"sn-block-image",style:"height: auto;"},n]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}}});const fa=t=>{const{event:e,content:n}=t,r=Pn({extensions:[$n,On.configure({protocols:["ftp","mailto"],autolink:!1}),ua,Rn,Nn.configure({nested:!0})],content:n,onUpdate:({editor:a})=>{o(a)}}),{run:o}=bt(a=>{e.emit(a)},{wait:50});return O.useEffect(()=>{r&&r.commands.setContent(n)},[n,r]),O.useEffect(()=>()=>{r&&r.destroy()},[r]),v.jsxs("div",{className:"sn-editor",children:[r&&v.jsx(Lr,{editor:r}),v.jsx(Fn,{editor:r})]})},da=R.div`
    height: 100%;
`,pa=t=>{const{note:e,tools:n}=yt(),{refresh:r}=t,[o,a]=O.useState(""),i=Jt(),{run:c}=bt(()=>{r()},{wait:500});return i.useSubscription(s=>{try{if(s.isEmpty)e.openId>0&&e.delectNote(e.openId).then(()=>{r(),e.openId=0});else{const l=s.getHTML();e.openId>0?e.updateNote(e.openId,{content:l}).then(()=>{c()}):e.openId===0&&e.addNote({content:l}).then(f=>{e.open(f),r()})}}catch(l){console.log("%c [ error ]-52","font-size:13px; background:pink; color:#bf2c9f;",l)}}),O.useEffect(()=>{e.openId>0?e.findNote(e.openId).then(s=>{s&&a(s.content)}).catch(s=>{s.name==="DatabaseClosedError"&&window.location.reload(),n.error("获取便签失败"),console.error("findNote",s)}):e.openId===0&&a("")},[e.openId]),v.jsx(da,{children:v.jsx(fa,{event:i,content:o})})},ma=vt(pa);class ha extends O.Component{createMarkup(e){return{__html:e}}extractText(e){const n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""}render(){const e=this.props.content,n=this.extractText(e);return v.jsx(v.Fragment,{children:n})}}function ga(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Lt(t,e)}var z=function(t){ga(e,t);function e(n){var r;return r=t.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+n+" for more information.")||this,Ht(r)}return e}(Dt(Error));function Be(t){return Math.round(t*255)}function va(t,e,n){return Be(t)+","+Be(e)+","+Be(n)}function ce(t,e,n,r){if(r===void 0&&(r=va),e===0)return r(n,n,n);var o=(t%360+360)%360/60,a=(1-Math.abs(2*n-1))*e,i=a*(1-Math.abs(o%2-1)),c=0,s=0,l=0;o>=0&&o<1?(c=a,s=i):o>=1&&o<2?(c=i,s=a):o>=2&&o<3?(s=a,l=i):o>=3&&o<4?(s=i,l=a):o>=4&&o<5?(c=i,l=a):o>=5&&o<6&&(c=a,l=i);var f=n-a/2,u=c+f,p=s+f,d=l+f;return r(u,p,d)}var it={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function ya(t){if(typeof t!="string")return t;var e=t.toLowerCase();return it[e]?"#"+it[e]:t}var ba=/^#[a-fA-F0-9]{6}$/,xa=/^#[a-fA-F0-9]{8}$/,ka=/^#[a-fA-F0-9]{3}$/,wa=/^#[a-fA-F0-9]{4}$/,Le=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Sa=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Ma=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Ca=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function ne(t){if(typeof t!="string")throw new z(3);var e=ya(t);if(e.match(ba))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(xa)){var n=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:n}}if(e.match(ka))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(wa)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var o=Le.exec(e);if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10)};var a=Sa.exec(e.substring(0,50));if(a)return{red:parseInt(""+a[1],10),green:parseInt(""+a[2],10),blue:parseInt(""+a[3],10),alpha:parseFloat(""+a[4])>1?parseFloat(""+a[4])/100:parseFloat(""+a[4])};var i=Ma.exec(e);if(i){var c=parseInt(""+i[1],10),s=parseInt(""+i[2],10)/100,l=parseInt(""+i[3],10)/100,f="rgb("+ce(c,s,l)+")",u=Le.exec(f);if(!u)throw new z(4,e,f);return{red:parseInt(""+u[1],10),green:parseInt(""+u[2],10),blue:parseInt(""+u[3],10)}}var p=Ca.exec(e.substring(0,50));if(p){var d=parseInt(""+p[1],10),m=parseInt(""+p[2],10)/100,g=parseInt(""+p[3],10)/100,x="rgb("+ce(d,m,g)+")",y=Le.exec(x);if(!y)throw new z(4,e,x);return{red:parseInt(""+y[1],10),green:parseInt(""+y[2],10),blue:parseInt(""+y[3],10),alpha:parseFloat(""+p[4])>1?parseFloat(""+p[4])/100:parseFloat(""+p[4])}}throw new z(5)}function Ia(t){var e=t.red/255,n=t.green/255,r=t.blue/255,o=Math.max(e,n,r),a=Math.min(e,n,r),i=(o+a)/2;if(o===a)return t.alpha!==void 0?{hue:0,saturation:0,lightness:i,alpha:t.alpha}:{hue:0,saturation:0,lightness:i};var c,s=o-a,l=i>.5?s/(2-o-a):s/(o+a);switch(o){case e:c=(n-r)/s+(n<r?6:0);break;case n:c=(r-e)/s+2;break;default:c=(e-n)/s+4;break}return c*=60,t.alpha!==void 0?{hue:c,saturation:l,lightness:i,alpha:t.alpha}:{hue:c,saturation:l,lightness:i}}function J(t){return Ia(ne(t))}var Ta=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},ze=Ta;function X(t){var e=t.toString(16);return e.length===1?"0"+e:e}function He(t){return X(Math.round(t*255))}function ja(t,e,n){return ze("#"+He(t)+He(e)+He(n))}function Te(t,e,n){return ce(t,e,n,ja)}function Ea(t,e,n){if(typeof t=="number"&&typeof e=="number"&&typeof n=="number")return Te(t,e,n);if(typeof t=="object"&&e===void 0&&n===void 0)return Te(t.hue,t.saturation,t.lightness);throw new z(1)}function Aa(t,e,n,r){if(typeof t=="number"&&typeof e=="number"&&typeof n=="number"&&typeof r=="number")return r>=1?Te(t,e,n):"rgba("+ce(t,e,n)+","+r+")";if(typeof t=="object"&&e===void 0&&n===void 0&&r===void 0)return t.alpha>=1?Te(t.hue,t.saturation,t.lightness):"rgba("+ce(t.hue,t.saturation,t.lightness)+","+t.alpha+")";throw new z(2)}function _e(t,e,n){if(typeof t=="number"&&typeof e=="number"&&typeof n=="number")return ze("#"+X(t)+X(e)+X(n));if(typeof t=="object"&&e===void 0&&n===void 0)return ze("#"+X(t.red)+X(t.green)+X(t.blue));throw new z(6)}function Ee(t,e,n,r){if(typeof t=="string"&&typeof e=="number"){var o=ne(t);return"rgba("+o.red+","+o.green+","+o.blue+","+e+")"}else{if(typeof t=="number"&&typeof e=="number"&&typeof n=="number"&&typeof r=="number")return r>=1?_e(t,e,n):"rgba("+t+","+e+","+n+","+r+")";if(typeof t=="object"&&e===void 0&&n===void 0&&r===void 0)return t.alpha>=1?_e(t.red,t.green,t.blue):"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")"}throw new z(7)}var Pa=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},$a=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},Oa=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},Ra=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function G(t){if(typeof t!="object")throw new z(8);if($a(t))return Ee(t);if(Pa(t))return _e(t);if(Ra(t))return Aa(t);if(Oa(t))return Ea(t);throw new z(8)}function Rt(t,e,n){return function(){var o=n.concat(Array.prototype.slice.call(arguments));return o.length>=e?t.apply(this,o):Rt(t,e,o)}}function N(t){return Rt(t,t.length,[])}function Na(t,e){if(e==="transparent")return e;var n=J(e);return G(B({},n,{hue:n.hue+parseFloat(t)}))}N(Na);function re(t,e,n){return Math.max(t,Math.min(e,n))}function Fa(t,e){if(e==="transparent")return e;var n=J(e);return G(B({},n,{lightness:re(0,1,n.lightness-parseFloat(t))}))}N(Fa);function Ba(t,e){if(e==="transparent")return e;var n=J(e);return G(B({},n,{saturation:re(0,1,n.saturation-parseFloat(t))}))}N(Ba);function La(t,e){if(e==="transparent")return e;var n=J(e);return G(B({},n,{lightness:re(0,1,n.lightness+parseFloat(t))}))}var Ha=N(La),he=Ha;function Da(t,e,n){if(e==="transparent")return n;if(n==="transparent")return e;if(t===0)return n;var r=ne(e),o=B({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),a=ne(n),i=B({},a,{alpha:typeof a.alpha=="number"?a.alpha:1}),c=o.alpha-i.alpha,s=parseFloat(t)*2-1,l=s*c===-1?s:s+c,f=1+s*c,u=(l/f+1)/2,p=1-u,d={red:Math.floor(o.red*u+i.red*p),green:Math.floor(o.green*u+i.green*p),blue:Math.floor(o.blue*u+i.blue*p),alpha:o.alpha*parseFloat(t)+i.alpha*(1-parseFloat(t))};return Ee(d)}var za=N(Da),Nt=za;function _a(t,e){if(e==="transparent")return e;var n=ne(e),r=typeof n.alpha=="number"?n.alpha:1,o=B({},n,{alpha:re(0,1,(r*100+parseFloat(t)*100)/100)});return Ee(o)}N(_a);function Wa(t,e){if(e==="transparent")return e;var n=J(e);return G(B({},n,{saturation:re(0,1,n.saturation+parseFloat(t))}))}N(Wa);function Ka(t,e){return e==="transparent"?e:G(B({},J(e),{hue:parseFloat(t)}))}N(Ka);function Ua(t,e){return e==="transparent"?e:G(B({},J(e),{lightness:parseFloat(t)}))}N(Ua);function qa(t,e){return e==="transparent"?e:G(B({},J(e),{saturation:parseFloat(t)}))}N(qa);function Ja(t,e){return e==="transparent"?e:Nt(parseFloat(t),"rgb(0, 0, 0)",e)}N(Ja);function Ga(t,e){return e==="transparent"?e:Nt(parseFloat(t),"rgb(255, 255, 255)",e)}N(Ga);function Ya(t,e){if(e==="transparent")return e;var n=ne(e),r=typeof n.alpha=="number"?n.alpha:1,o=B({},n,{alpha:re(0,1,+(r*100-parseFloat(t)*100).toFixed(2)/100)});return Ee(o)}N(Ya);const{useToken:Xa}=Gt,Qa=R(zn)`
  min-height: calc(100vh - ${Mt}px);
  background-color: var(--fff);
`,Za=R(Ct)`
    &:after{
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        transform: translateX(100%);
        width: 20px;
        height: 100%;
        box-shadow: var(--notebrBoxShadow) 16px 0px 20px -10px inset;
        z-index: 10;
        border-right: 1px solid var(--notebrColor);
    }
`,Va=R(Ct)`
    transition: all 0.3s;
    border-left: 1px solid var(--borderColor);
`,es=R.div`
    height: 50px;
    border-bottom: 1px solid var(--notebrColor);
    box-sizing: border-box;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
`,ts=R.div`
 height: calc(100vh - ${Mt+50}px);
 overflow-y: auto;
`,ct=R(Hn.div)`
    cursor: pointer;
    height: 50px;
    box-sizing: border-box;
    border-bottom: 1px solid var(--notebrColor);
    padding: 0 20px;
    display: flex;
    .left {
        display: flex;
        justify-content: center;
        align-items: center;
        .ant-checkbox {
            margin-right: 10px;
        }
    }
    .right {
        flex: 1;
        width: 0;
        position: relative;
        .sticky {
            position: absolute;
            top: 50%;
            right: 4px;
            transform: translateY(-50%);
            color: var(--fff);
            background-color: ${t=>he(.2,t.colorPrimary)};
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%; 
        }
    }
    &.active {
        background-color: ${t=>t.colorPrimaryBg};
        .ant-typography {
            color: ${t=>he(.2,t.colorPrimary)};
        }
        time {
            color: ${t=>he(.3,t.colorPrimary)};
        }
        .right {
            .sticky {
                color: ${t=>he(.2,t.colorPrimary)};
                background-color: var(--fff);
            }
        }
    }
`,lt=R.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 0 0;
    time {
        font-size: 12px;
        color: #666;
    }
`,ut=R(en.Text)`
    font-size: 14px;
    color: #444;
`,ns=R.div`
    display: flex;
    height: 50px;
    align-items: center;
    position: absolute;
    top: 0;
    right: 20px;
`,rs=R(ue)`
    display: flex;
    justify-content: flex-start;
    align-items: center;
    color: #666;
`,ft=R(ue)`
    display: flex;
    justify-content: center;
    align-items: center;
`,os=R(ue)`
    display: flex;
    justify-content: center;
    align-items: center;
`,as=R(ue)`
    display: flex;
    justify-content: center;
    align-items: center;
`,dt=window.innerWidth,pt=window.innerHeight,ae=240,se=240;function ss(t,e,n){return n.some(r=>t<r.left+ae&&t+ae>r.left&&e<r.top+se&&e+se>r.top)}function is(t,e=70,n=70){let r=e,o=n;for(;;){if(!ss(r,o,t)&&r+ae<=dt&&o+se<=pt)return{left:r,top:o};if(r+=ae,r+ae>dt&&(r=e,o+=se),o+se>pt)throw new Error("没有足够的空间放置新的div")}}const cs=t=>{const{tools:e,note:n,option:r,home:o}=yt(),{token:a}=Xa(),[i,c]=O.useState(!1),[s,l]=O.useState([]),f=O.useRef(null),u=O.useRef(null),p=j(()=>n.getNote(1,9999).then(M=>M.list)),{data:d,error:m,refresh:g,run:x}=Er(p,{manual:!0}),y=j(M=>{n.open(M)}),S=j(M=>{n.delectNote(M).then(()=>{g(),n.openId=-1,i&&c(!1)})}),C=j(()=>{const{homeNoteData:M}=r.item,W=M?.map(Y=>Y.id)||[];l(W)}),T=O.useMemo(()=>(typeof d<"u"&&!d?.length&&!m&&n.openId!=0&&setTimeout(()=>{n.open(0)},50),Array.from(d||[])),[d]),I=O.useMemo(()=>(d||[]).map(M=>M.id),[d]),[h]=Br(T,{containerTarget:f,wrapperTarget:u,itemHeight:50,overscan:10}),{selected:b,allSelected:k,isSelected:A,toggle:F,toggleAll:D,partiallySelected:Ae}=Ar(I),fe=O.useCallback((M,W)=>{M.stopPropagation(),M.preventDefault();const Y=s?.includes(W);e.setRightClickEvent(M,[{label:Y?"从首屏移除":"贴在首屏",icon:Y?v.jsx(Dn,{}):v.jsx(tt,{}),key:"top",onClick:()=>{if(Y)n.removeSticky(W,!0);else try{const{homeNoteData:Pe}=r.item,Xe=is(Pe);n.addSticky({id:W,left:Xe.left,top:Xe.top})}catch(Pe){console.error(Pe.message)}setTimeout(()=>{C()},200)}},{label:"删除便签",icon:v.jsx($e,{}),key:"del-group",onClick:()=>{S([W])}}])},[s]);return O.useEffect(()=>{x(),C()},[]),O.useEffect(()=>{n.openId==-1&&h?.length&&n.open(h[0]?.data?.id)},[h]),ie(()=>{setTimeout(()=>{n.open(-1),g(),C()},300)},[e.timeKey]),v.jsxs(Qa,{className:"sn-bg-wrap",children:[v.jsxs(Za,{span:7,children:[v.jsxs(es,{children:[v.jsx("div",{className:"left",children:i?v.jsxs(Bn,{children:[v.jsx(nt,{checked:k,onClick:D,indeterminate:Ae,children:"全选"}),v.jsx(Qe,{placement:"bottomRight",title:"确认删除该便签吗?",onConfirm:()=>S(b),okText:"确定",cancelText:"取消",disabled:b.length===0,children:v.jsx(ft,{danger:!0,disabled:b.length===0,size:"small",icon:v.jsx($e,{size:16,stroke:1.4}),children:"删除"})}),v.jsx(ft,{size:"small",icon:v.jsx(Vt,{size:16,stroke:1.4}),onClick:()=>c(!1),children:"取消"})]}):v.jsx(ge,{placement:"top",title:"批量删除",children:v.jsx(rs,{type:"link",disabled:I.length===0,icon:v.jsx(Un,{size:18,stroke:1.4}),onClick:()=>c(!0)})})}),v.jsx("div",{className:"right",children:v.jsx(ge,{placement:"top",title:"新增便签",children:v.jsx(os,{icon:v.jsx(Ln,{size:18,stroke:1.4}),onClick:()=>{n.open(0)}})})})]}),v.jsx(ts,{ref:f,className:"scroll-container",children:v.jsxs("div",{ref:u,children:[n.openId===0?v.jsx(ct,{className:"active",colorPrimaryBg:a.colorPrimaryBg,colorPrimary:a.colorPrimary,children:v.jsxs("div",{className:"right",children:[v.jsx(lt,{children:v.jsx("time",{children:Ze().format("YYYY年MM月DD日 HH:mm")})}),v.jsx(ut,{ellipsis:!0,children:"新建便签"})]})}):null,(h||[]).map((M,W)=>v.jsxs(ct,{onClick:()=>y(M.data?.id),className:M.data?.id===n.openId?"active":"",colorPrimaryBg:a.colorPrimaryBg,colorPrimary:a.colorPrimary,onContextMenu:Y=>fe(Y,M.data?.id),children:[v.jsx("div",{className:"left",children:i?v.jsx(nt,{checked:A(M.data?.id),onClick:()=>F(M.data?.id)}):null}),v.jsxs("div",{className:"right",children:[v.jsx(lt,{children:v.jsx("time",{children:Ze(M.data?.updateTime).format("YYYY年MM月DD日 HH:mm")})}),v.jsx(ut,{ellipsis:!0,children:v.jsx(ha,{content:M.data?.content})}),s.includes(M.data?.id)?v.jsx("div",{className:"sticky",children:v.jsx(tt,{size:14,stroke:1.8})}):null]})]},M.data?.id))]})})]}),v.jsxs(Va,{span:17,children:[v.jsx(ns,{children:n.openId>0?v.jsx(Qe,{placement:"bottomRight",title:"确认删除该便签吗?",onConfirm:()=>S([n.openId]),okText:"确定",cancelText:"取消",children:v.jsx(ge,{placement:"top",title:"删除便签",children:v.jsx(as,{danger:!0,type:"text",icon:v.jsx($e,{size:20,stroke:1.4})})})}):null}),v.jsx(ma,{refresh:g})]})]})},js=vt(cs);export{js as default};
