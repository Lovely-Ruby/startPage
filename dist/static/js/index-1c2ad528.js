import{c as w,R as a,j as n,T as O,_ as L,s as z}from"./styled-components.browser.esm-1bf82734.js";import{o as D,b as P,R as B,S as j,O as U,M as X,T as M,U as _,N as q}from"./src/newtab/index-25a29073.js";import{I as G,a as H,b as V,c as W,u as T,d as b,L as J}from"./LinkItem-9c55974f.js";import{d as R}from"./index-85382f69.js";import{I as Q,R as Y,C as Z}from"./index-abbb261f.js";import{I as A,a as ee}from"./IconDeviceDesktop-2292f5b8.js";import{m as te}from"./motion-78770865.js";import"./FavIconIcon-6844105d.js";import"./CheckOutlined-e912d693.js";import"./EllipsisOutlined-8a1cae9e.js";import"./Overflow-2c41ac00.js";var ne=w("external-link","IconExternalLink",[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]]),se=w("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const ie=m=>{const{item:e,titleClass:d="",onChange:K=()=>{},onDelete:y=()=>{},onOpenAll:f=()=>{},onCopyAll:x=()=>{}}=m,[g,p]=a.useState(!1),i=a.useRef(null),{option:k,tools:u}=P(),{homeLinkTimeKey:h}=k.item,I=r=>{const c=r.target.value;c&&(e.title=c,K(c)),p(!1)},v=()=>{p(!0),setTimeout(()=>{i.current.focus({cursor:"end"})},0)},C=a.useCallback(r=>{r.stopPropagation(),r.preventDefault();const c=[{label:"打开全部链接",icon:n.jsx(ne,{}),key:"open-all-link",onClick:f},{label:"复制全部链接",icon:n.jsx(G,{}),key:"copy-all-link",onClick:x},{label:"编辑标题",icon:n.jsx(H,{}),key:"edit-title",onClick:v},{label:"移动分组",icon:n.jsx(V,{}),key:"move-group",onClick:()=>{u.openPublicModal("MoveGroup",{},"auto","移动分组")}},{label:"删除分组",icon:n.jsx(W,{}),key:"del-group",onClick:y}];h==e.timeKey?c.push({label:"从首屏移除",icon:n.jsx(ee,{}),key:"del-home",onClick:()=>{k.setItem("homeLinkTimeKey",null)}}):c.push({label:"添加到首屏",icon:n.jsx(A,{}),key:"add-home",onClick:()=>{k.setItem("homeLinkTimeKey",e.timeKey)}}),u.setRightClickEvent(r,c)},[e.timeKey,h]);return n.jsxs("div",{className:"link-title",onContextMenu:C,children:[g?n.jsx("div",{children:n.jsx(Q,{type:"text",ref:i,className:d+" link-title-item link-title-input",defaultValue:e.title,onBlur:I,bordered:!1})}):n.jsx("h4",{onClick:v,className:d+" link-title-item",children:e.title}),h==e.timeKey?n.jsx(O,{title:"此分组已在首屏展示",children:n.jsx("div",{className:"link-title-icon",children:n.jsx(A,{size:18,stroke:1.6})})}):null]})},le=D(ie),{confirm:oe}=q,ae="分组",E={8:3,6:4,4:6},re={show:{opacity:1,y:0,x:0,scale:1},hidden:{opacity:0,y:"100%",x:"100%",scale:.8}},ce=a.forwardRef((m,e)=>n.jsx(Y,{ref:e,gutter:[16,16],children:m.children})),me=m=>{m.forEach(e=>{window.open(e.url)})},ue=m=>{const{link:e,tools:d,option:K}=P(),{linkSpan:y}=K.item,{warpRef:f}=m,[x,g]=a.useState(!1),p=a.useRef(null),i=a.useRef({updateList:[],isChange:!1}).current,k=B();k.useSubscription(t=>{(t||[]).length!==0&&(r(t),d.tabListDrawer=!1)});const u=T(t=>{e.updateData(t),setTimeout(()=>{e.setCache()},0)},150),h=T(t=>{e.updateLink(t),setTimeout(()=>{e.setCache()},0)},150),I=T(t=>{e.deleteLinkByTimeKey(t.map(l=>l.timeKey)),setTimeout(()=>{e.setCache()},0)},150),v=j((t,l=!1)=>{l?oe({title:"确认删除全部?",icon:n.jsx(U,{}),content:"即将删除此分组下所有链接",okText:"确认",okType:"danger",cancelText:"取消",onOk(){L.remove(e.list,s=>s.timeKey===t.timeKey||s.parentId===t.timeKey),u(e.list)},onCancel(){}}):(I([t]),L.remove(e.list,s=>s.timeKey===t.timeKey))},[e.list]),C=j((t,l)=>{L.remove(e.list,s=>s.parentId===t),e.list.push(...Array.from(l)),i.isChange&&(u(e.list),i.isChange=!1)},[e.list,u,i]),r=j(t=>{i.isChange=!0;const l=X(),s=[];s.push({title:ae,timeKey:l,parentId:e.getActiveID,sort:e.titleLink.length}),s.push(...M(t,l,!0)),e.list.push(...Array.from(s)),u(e.list),i.isChange=!1},[i,e.getActiveID,e.titleLink.length,e.list,u]),c=j(t=>{const l=t.map(s=>s.title+" "+s.url).join(`
`);_(l).then(s=>{s?d.messageApi.open({type:"success",content:"复制成功"}):d.messageApi.open({type:"error",content:"复制失败"})})}),S=b(()=>e.titleLink.map((t,l)=>{const s=e.linkForId(t.timeKey);return n.jsxs("div",{className:`link-panel link-module-span-${E[y]}`,children:[n.jsx(le,{item:t,onChange:()=>{h([t])},onOpenAll:()=>{me(s)},onCopyAll:()=>{c(s)},onDelete:()=>{v(t,s.length>0)}}),n.jsx(R.ReactSortable,{tag:ce,name:"tab-list",animation:150,group:"linkItem",ghostClass:["link-item-ghost"],list:s,scroll:p.current,setList:o=>{i.updateList[t.timeKey]&&(i.isChange=!0,Promise.resolve().then(()=>{C(t.timeKey,M(o,t.timeKey)),i.updateList[t.timeKey]=!1}))},onStart:o=>{g(!0)},onEnd:o=>{g(!1)},onUpdate:o=>{i.updateList[t.timeKey]=!0},onAdd:o=>{i.updateList[t.timeKey]=!0},onRemove:o=>{i.updateList[t.timeKey]=!0},children:s.map(o=>n.jsx(Z,{span:E[y],children:n.jsx(J,{...o,onDelete:()=>{I([o]),L.remove(e.list,$=>$.timeKey===o.timeKey)}})},o.timeKey))})]},t.timeKey)}),[e.titleLink,e.linkForId,y,h,i,C]),N=b(()=>n.jsxs("div",{className:`link-new-panel ${e.titleLink.length===0?"null fadeIn-element":""}`,children:[e.titleLink.length===0?n.jsx("span",{className:"null_help ",children:"请从右侧拖入标签到区块内"}):null,n.jsx(R.ReactSortable,{name:"tab-list",animation:150,group:"linkItem",ghostClass:["link-item-ghost-new"],list:[],setList:t=>{t.length!==0&&r(t)}})]}),[r,e.titleLink]),F=b(()=>n.jsxs(te.div,{className:"link-delect-panel",initial:"hidden",animate:x?"show":"hidden",variants:re,transition:{duration:.2,ease:"easeIn"},children:[n.jsx(R.ReactSortable,{name:"tab-list",animation:150,group:"linkItem",className:"link-delect-panel-box",ghostClass:["link-item-delect"],list:[],setList:t=>{}}),n.jsx(se,{size:40})]}),[x]);return a.useEffect(()=>{e.addPanelToLinkItemEmitter=k},[]),a.useEffect(()=>{f.current&&!p.current&&(p.current=f.current.querySelector(".scroll-container"))},[f,p]),e.isInit?n.jsxs(n.Fragment,{children:[S,N,F]}):null},pe=D(ue),de=z.div`
  padding: 20px;
`,ke=m=>{const e=a.useRef(null);return n.jsx(de,{ref:e,children:n.jsx(pe,{warpRef:e})})},Te=D(ke);export{Te as default};
